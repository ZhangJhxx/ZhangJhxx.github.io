---
title: 常见前端手写代码题
date: 2022-02-09 23:18:07
tags: 
- 算法
categories: 
- 算法
---

### new的过程发生了什么

在new的过程中
- 像普通函数执行一样，形成一个私有的作用域
   +形参赋值
   +变量提升
- 默认创建一个对象，让函数中的this执行这个对象，这个对象就是当前的一个实例
- 执行代码
- 把默认创建的对象返回

```js
function _new(Fn, ...arg) {
  // let obj = {};
  // obj.__proto__ = Fn.prototype;
  //创建一个空对象 并使其作为Fn.prototype的所属的构造函数
  let obj = Object.create(Fn.prototype);
  //记录函数的返回值，如果返回对象或函数则return res
  const res = Fn.call(obj, ...arg);
  const isObjOrFunc =  typeof res === "function" || (typeof res === "object" && res !== null);
  return isObjOrFunc ? res : obj;
}
```

### 用requestAnimationFrame写setTimeout

```js
const _timerId = {};//记录定时器的编号
let _id = 0;
function mySetTimeOut(fn, delay, ...args) {
  const start = new Date().getTime();
  const cid = ++_id;
  const loop = () => {
    const time = new Date().getTime();
    if (time >= delay + start){
      fn.apply(this, args);
      delete _timerId[cid];
    } else {
      _timerId[cid] = requestAnimationFrame(loop);
    }
  };
  _timerId[cid] = requestAnimationFrame(loop);
  return cid;
}
//测试部分
const timer = mySetTimeOut(()=>{console.log(123)},2000)
console.log(timer);
```

```
```
